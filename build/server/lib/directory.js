// Generated by CoffeeScript 1.9.3
var changeOwner, config, fs, path, rmdir, spawn;

path = require('path');

fs = require('fs');

rmdir = require('rimraf');

spawn = require('child_process').spawn;

config = require('./conf').get;


/*
    Change owner for folder path
 */

changeOwner = function(user, path, callback) {
  var child;
  child = spawn('chown', ['-R', user + ":" + user, path]);
  return child.on('exit', function(code) {
    if (code !== 0) {
      return callback(new Error('Unable to change permissions'));
    } else {
      return callback();
    }
  });
};


/*
    Create directory for <app>
 */

module.exports.create = function(app, callback) {
  var dirPath, error, user;
  dirPath = path.join(config('dir_app_data'), app.name);
  user = app.user;
  if (fs.existsSync(dirPath)) {
    return callback();
  } else {
    try {
      return fs.mkdir(dirPath, "0700", function(err) {
        if (err) {
          return callback(err);
        } else {
          return changeOwner(app.user, dirPath, function(err) {
            return callback(err);
          });
        }
      });
    } catch (_error) {
      error = _error;
      return callback(error);
    }
  }
};


/*
    Remove directory for <app>
 */

module.exports.remove = function(app, callback) {
  var dirPath;
  dirPath = path.join(config('dir_app_data'), app.name);
  if (fs.existsSync(dirPath)) {
    return rmdir(dirPath, callback);
  } else {
    return callback();
  }
};

// Generated by CoffeeScript 1.9.3
var fs, path, root, spawn;

path = require('path');

fs = require('fs');

root = '/usr/local/var/cozy';

spawn = require('child_process').spawn;


/*
    Create directory for <app>
 */

module.exports.create = function(app, callback) {
  var changeOwner, dirPath, error, user;
  changeOwner = function(path, callback) {
    var child;
    child = spawn('chown', ['-R', app.user, path]);
    return child.on('exit', function(code) {
      if (code !== 0) {
        return callback(new Error('Unable to change permissions'));
      } else {
        return callback();
      }
    });
  };
  dirPath = path.join(root, app.name);
  user = app.user;
  if (fs.existsSync(dirPath)) {
    return callback();
  } else {
    try {
      return fs.mkdir(dirPath, "0700", function(err) {
        if (err) {
          return callback(err);
        } else {
          return changeOwner(dirPath, function(err) {
            return callback(err);
          });
        }
      });
    } catch (_error) {
      error = _error;
      return callback(error);
    }
  }
};
